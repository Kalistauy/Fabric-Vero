
name: Fabric Deployment Pipeline

on:
  workflow_dispatch: {}

jobs:
  deploy-dev-to-test:
    runs-on: windows-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Check available scripts
        shell: pwsh
        run: Get-ChildItem -Recurse

      - name: "Run deployment Dev → Test"
        shell: pwsh
        run: ./scripts/DevToTest.ps1 -ClientId "${{ secrets.CLIENT_ID }}" -TenantId "${{ secrets.TENANT_ID }}" -ClientSecret "${{ secrets.CLIENT_SECRET }}"

  deploy-test-to-prod:
    runs-on: windows-latest
    needs:
      - deploy-dev-to-test
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Check available scripts
        shell: pwsh
        run: Get-ChildItem -Recurse

      - name: "Run deployment Test → Prod"
        shell: pwsh
        run: ./scripts/TestToProd.ps1 -ClientId "${{ secrets.CLIENT_ID }}" -TenantId "${{ secrets.TENANT_ID }}" -ClientSecret "${{ secrets.CLIENT_SECRET }}"

      - name: Confirm deployment success
        shell: pwsh
        run: "Write-Host '✅ Deployment Test → Prod completed successfully.' -ForegroundColor Green"
