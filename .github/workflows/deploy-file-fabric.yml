name: Fabric Deployment Pipeline

on:
  workflow_dispatch:

jobs:
  deploy-dev-to-test:
    runs-on: windows-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Verificar scripts disponibles
        shell: pwsh
        run: |
          Write-Host "Contenido del directorio actual:"
          Get-ChildItem -Recurse

      - name: Ejecutar despliegue Dev → Test
        shell: pwsh
        run: |
          ./DeployDevToTest_final_parametrizado.ps1 `
            -ClientId "${{ secrets.CLIENT_ID }}" `
            -TenantId "${{ secrets.TENANT_ID }}" `
            -ClientSecret "${{ secrets.CLIENT_SECRET }}"

  deploy-test-to-prod:
    runs-on: windows-latest
    needs:
      - deploy-dev-to-test
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Verificar scripts disponibles
        shell: pwsh
        run: |
          Write-Host "Contenido del directorio actual:"
          Get-ChildItem -Recurse

      - name: Ejecutar despliegue Test → Prod
        shell: pwsh
        run: |
          ./DeployTestToProd_parametrizado.ps1 `
            -ClientId "${{ secrets.CLIENT_ID }}" `
            -TenantId "${{ secrets.TENANT_ID }}" `
            -ClientSecret "${{ secrets.CLIENT_SECRET }}"
