name: Fabric Deployment Pipeline
'on':
  workflow_dispatch: {}
jobs:
  deploy-dev-to-test:
    runs-on: windows-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    - name: Validar variables de entorno
      shell: pwsh
      run: "\n                        if (-not $env:CLIENT_ID) { Write-Host 'ERROR:\
        \ CLIENT_ID no est\xE1 definido.' -ForegroundColor Red; exit 1 }\n       \
        \                 if (-not $env:TENANT_ID) { Write-Host 'ERROR: TENANT_ID\
        \ no est\xE1 definido.' -ForegroundColor Red; exit 1 }\n                 \
        \       if (-not $env:CLIENT_SECRET) { Write-Host 'ERROR: CLIENT_SECRET no\
        \ est\xE1 definido.' -ForegroundColor Red; exit 1 }\n                    "
    - name: "Ejecutar despliegue Dev \u2192 Test"
      shell: pwsh
      run: ./DeployDevToTest_final_corregido.ps1
      env:
        CLIENT_ID: ${{ secrets.CLIENT_ID }}
        TENANT_ID: ${{ secrets.TENANT_ID }}
        CLIENT_SECRET: ${{ secrets.CLIENT_SECRET }}
  deploy-test-to-prod:
    runs-on: windows-latest
    needs:
    - deploy-dev-to-test
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    - name: Validar variables de entorno
      shell: pwsh
      run: "\n                        if (-not $env:CLIENT_ID) { Write-Host 'ERROR:\
        \ CLIENT_ID no est\xE1 definido.' -ForegroundColor Red; exit 1 }\n       \
        \                 if (-not $env:TENANT_ID) { Write-Host 'ERROR: TENANT_ID\
        \ no est\xE1 definido.' -ForegroundColor Red; exit 1 }\n                 \
        \       if (-not $env:CLIENT_SECRET) { Write-Host 'ERROR: CLIENT_SECRET no\
        \ est\xE1 definido.' -ForegroundColor Red; exit 1 }\n                    "
    - name: "Ejecutar despliegue Test \u2192 Prod"
      shell: pwsh
      run: ./DeployTestToProd_corregido.ps1
      env:
        CLIENT_ID: ${{ secrets.CLIENT_ID }}
        TENANT_ID: ${{ secrets.TENANT_ID }}
        CLIENT_SECRET: ${{ secrets.CLIENT_SECRET }}
